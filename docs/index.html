<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>tiff2pdf-web</title>

    <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
    <style type="text/css">
        .bs-component+.bs-component {
            margin-top: 1rem;
        }

        @media (min-width: 768px) {
            .bs-docs-section {
                margin-top: 8em;
            }

            .bs-component {
                position: relative;
            }

            .bs-docs-section .page-header h1 {
                padding: .5rem 0;
                margin-bottom: 2rem;
                border-bottom: 1px solid #eee;
            }

            .bs-component .modal {
                position: relative;
                top: auto;
                right: auto;
                bottom: auto;
                left: auto;
                z-index: 1;
                display: block;
            }

            .bs-component .modal-dialog {
                width: 90%;
            }

            .bs-component .popover {
                position: relative;
                display: inline-block;
                width: 220px;
                margin: 20px;
            }

            .nav-tabs {
                margin-bottom: 15px;
            }

            .progress {
                margin-bottom: 10px;
            }
        }
    </style>
</head>

<body>

    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container">
                <a class="navbar-brand" href="./">
                    tiff2pdf-web
                </a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar"
                    aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbar">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="./">Top <span class="sr-only">(current)</span></a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <div class="container">
        <h1>cmain.js</h1>
        <p>cmain.js は emsdk でビルドされた簡単な WebAssembly です。
            ビルドシステムの都合で、単一の <code>.js</code> へ結合した状態で欲しかったため
            (本来は <code>.js</code> と <code>.wasm</code> に別れるところ)
            <code>-s SINGLE_FILE=1</code> を指定してビルドしています。
        </p>
        <p>使用方法は、<b>開発者ツール</b>の<b>コンソール</b>機能を開いて実験してください。
            通常は <kbd>F12</kbd> を押下することで開きます。</p>

        <div class="card mb-3">
            <div class="card-header">インスタンス作成例</div>
            <div class="card-body">
                <p class="card-text">
                <p>例:</p>
                <pre><code>cmain = await create_cmain()</code></pre>
                <p><var>cmain</var> が起動した <var>Module</var> になります。この方法ですと <var>main</var> を実行してしまいます。</p>
                <img src="img/ex1.png">
                </p>
            </div>
        </div>

        <div class="card mb-3">
            <div class="card-header">main を起動しない</div>
            <div class="card-body">
                <p class="card-text">
                <p>例:</p>
                <pre><code>cmain = await create_cmain({noInitialRun: true})</code></pre>
                <p><var>cmain</var> が起動した <var>Module</var> になります。この方法ですと <var>main</var> は実行されません。</p>
                <p>改めて <var>callMain</var> を使用し <var>main</var> を実行しましょう。</p>
                <pre><code>cmain.callMain(["入力ファイル名","-o","出力ファイル名"])</code></pre>
                <img src="img/ex2.png">
                </p>
            </div>
        </div>

        <h1>tiff2pdf.js</h1>
        <p>tiff2pdf.js と tiff2pdf.wasm は emsdk でビルドされた tiff2pdf の WebAssembly 版です。</p>

        <div class="card mb-3">
            <div class="card-header">自動で変換例</div>
            <div class="card-body">
                <p class="card-text">
                <p>こちらへ TIFF ファイルを投入してください</p>
                <blockquote>
                    <input id="tiffInput" type="file" />
                </blockquote>
                <p>ここに PDF を表示します</p>
                <div>
                    <object id="pdfOutput" width="100%" height="480" style="background-color: gray;"></object>
                </div>
                </p>
            </div>
        </div>

        <p>手動版の使用方法は、<b>開発者ツール</b>の<b>コンソール</b>機能を開いて実験してください。
            通常は <kbd>F12</kbd> を押下することで開きます。</p>

        <div class="card mb-3">
            <div class="card-header">手動で変換例</div>
            <div class="card-body">
                <p class="card-text">
                <p>例:</p>
                <pre><code>
tiff2pdf = await create_tiff2pdf({noInitialRun: true})

tiff2pdf.FS.writeFile("/tmp/input.tif", new Uint8Array([0x49,0x49,0x2A,0x00,0x20,0x00,0x00,0x00,0x80,0x3F,0xE0,0x4F,0xF0,0x04,0x16,0x0D,0x07,0x82,0xC0,0xE0,0x90,0x88,0x64,0x2A,0x19,0x0D,0x81,0xC3,0xE1,0x10,0x10,0x00,0x15,0x00,0xFE,0x00,0x04,0x00,0x01,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x01,0x03,0x00,0x01,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x01,0x01,0x03,0x00,0x01,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x02,0x01,0x03,0x00,0x04,0x00,0x00,0x00,0x32,0x01,0x00,0x00,0x03,0x01,0x03,0x00,0x01,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x06,0x01,0x03,0x00,0x01,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x0A,0x01,0x03,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x11,0x01,0x04,0x00,0x01,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x12,0x01,0x03,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x15,0x01,0x03,0x00,0x01,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x16,0x01,0x03,0x00,0x01,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x17,0x01,0x04,0x00,0x01,0x00,0x00,0x00,0x17,0x00,0x00,0x00,0x1A,0x01,0x05,0x00,0x01,0x00,0x00,0x00,0x22,0x01,0x00,0x00,0x1B,0x01,0x05,0x00,0x01,0x00,0x00,0x00,0x2A,0x01,0x00,0x00,0x1C,0x01,0x03,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x1D,0x01,0x02,0x00,0x07,0x00,0x00,0x00,0x42,0x01,0x00,0x00,0x28,0x01,0x03,0x00,0x01,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x29,0x01,0x03,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3D,0x01,0x03,0x00,0x01,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x52,0x01,0x03,0x00,0x01,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x53,0x01,0x03,0x00,0x04,0x00,0x00,0x00,0x3A,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x2C,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x2C,0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x08,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x50,0x61,0x67,0x65,0x20,0x30,0x00]))

tiff2pdf.callMain(["-o", "/tmp/output.pdf", "/tmp/input.tif"])

pdfByteArray = tiff2pdf.FS.readFile("/tmp/output.pdf")

pdfBlob = new Blob([pdfByteArray], {type: "application/pdf"})

fileReader = new FileReader()

fileReader.readAsDataURL(pdfBlob)

document.getElementById("viewer").data = fileReader.result
</code></pre>
                <p>ここに PDF を表示:</p>
                <div>
                    <object id="viewer" width="100%" height="480" style="background-color: gray;"></object>
                </div>
                </p>
            </div>
        </div>


    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="./js/bootstrap.min.js"></script>
    <script src="./js/cmain.js"></script>
    <script src="./js/tiff2pdf.js"></script>

    <script type="text/javascript">
        $("#tiffInput").on("change", async function () {
            const inputTag = this;
            const tiffBlob = new Blob([inputTag.files[0]]);

            const tiff2pdf = await create_tiff2pdf({ noInitialRun: true });

            tiff2pdf.FS.writeFile("/tmp/input.tif", new Uint8Array(await tiffBlob.arrayBuffer()));

            tiff2pdf.callMain(["-o", "/tmp/output.pdf", "/tmp/input.tif"]);

            const pdfByteArray = tiff2pdf.FS.readFile("/tmp/output.pdf");

            const pdfBlob = new Blob([pdfByteArray], { type: "application/pdf" });

            const fileReader = new FileReader();

            fileReader.readAsDataURL(pdfBlob);

            $(fileReader).on("load", function () {
                $("#pdfOutput").prop("data", fileReader.result);
            })
        });
    </script>

</body>

</html>